

# pgpool基础介绍

#### pgpool-II 是一个位于 PostgreSQL 服务器和 PostgreSQL 数据库客户端之间的中间件，它提供以下功能：

- 连接池
- pgpool-II 保持已经连接到 PostgreSQL 服务器的连接， 并在使用相同参数（例如：用户名，数据库，协议版本） 连接进来时重用它们。 它减少了连接开销，并增加了系统的总体吞吐量。

- 复制
- pgpool-II 可以管理多个 PostgreSQL 服务器。 激活复制功能并使在2台或者更多 PostgreSQL 节点中建立一个实时备份成为可能， 这样，如果其中一台节点失效，服务可以不被中断继续运行。

- 负载均衡
- 如果数据库进行了复制（可能运行在复制模式或者主备模式下）， 则在任何一台服务器中执行一个 SELECT 查询将返回相同的结果。 pgpool-II 利用了复制的功能以降低每台 PostgreSQL 服务器的负载。 它通过分发 SELECT 查询到所有可用的服务器中，增强了系统的整体吞吐量。 在理想的情况下，读性能应该和 PostgreSQL 服务器的数量成正比。 负载均很功能在有大量用户同时执行很多只读查询的场景中工作的效果最好。

- 限制超过限度的连接
- PostgreSQL 会限制当前的最大连接数，当到达这个数量时，新的连接将被拒绝。 增加这个最大连接数会增加资源消耗并且对系统的全局性能有一定的负面影响。 pgpoo-II 也支持限制最大连接数，但它的做法是将连接放入队列，而不是立即返回一个错误。



pgpool-II 使用 PostgreSQL 的前后台程序之间的协议，并且在前后台之间传递消息。 因此，一个（前端的）数据库应用程序认为 pgpool-II 就是实际的 PostgreSQL 数据库， 而后端的服务进程则认为 pgpool-II 是它的一个客户端。 因为 pgpool-II 对于服务器和客户端来说是透明的， 现有的数据库应用程序基本上可以不需要修改就可以使用 pgpool-II 了。



## 重要特性介绍：

## 看门狗

“看门狗”是一个 pgpool-II 的子进程，用于添加高可用性功能。 这通过多个 pgpool-II 的合作解决了单点故障的问题。 pgpool-II **V3.5 -** 的看门狗功能得到了显著增强，已经可以确保全天候运行。 不过，要确保全天候运行机制能正常运行，需要的 pgpool-II 节点数必须大于或等于 3 且节点数必须为奇数。 新增的看门狗在故障耐受力更强，在处理脑列情况和网络分裂时候会更强壮。 看门狗提供以下功能。

### pgpool-II 服务的生命检测

看门狗的存活检测是看门狗用于监控用于提供高可用的看门狗集群中的 pgpool-II 节点的健康状况的子组件。 “heartbeat（心跳）”和“query（查询）”模式。

### 协调多个 pgpool-II 共同工作

校验所有节点重要配置参数的一致性

在检测到某些故障时交换活跃/备用状态

在服务器切换的时候实现自动虚拟 IP 地址分配

在恢复的时候自动注册服务器为备用服务器







参考链接：

<http://www.pgpool.net/docs/pgpool-II-3.5.4/doc/pgpool-zh_cn.html#watchdog>