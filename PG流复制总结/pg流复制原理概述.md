# 流复制原理

PostgreSQL在9.0之后引入了主备流复制机制，通过流复制，备库不断的从主库同步相应的数据，并在备库apply每个WAL record，这里的流复制每次传输单位是WAL日志的record。而PostgreSQL9.0之前提供的方法是主库写完一个WAL日志文件后，才把WAL日志文件传送到备库，这样的方式导致主备延迟特别大。同时PostgreSQL9.0之后提供了Hot Standby，备库在应用WAL record的同时也能够提供只读服务，大大提升了用户体验。

### 同步复制

一主一备时，只有当主备节点都正常运行时，sql才正常运行。备挂掉后，提交到主节点的sql会一直阻塞，直到备节点恢复正常。

一主多备时，同步复制时，只有一个备处于同步模式，其他备处于潜在同步模式，实际上还是异步模式。一旦当发生切换，就会有一个备转换到同步复制模式。

优点：数据完全不丢失。

缺点：低效。容易出问题。不适合生产环境。



### 异步复制

sql提交后，数据在后台自动往备节点同步。不会出现备节点数据同步过程中阻塞主节点的情况。

优点：高效、适合生产环境。通常部署一主多备，允许多次故障恢复。

缺点：可能会丢失部分少量数据。



#### 各自区别、使用场景分析





#### 参考链接

https://yq.aliyun.com/articles/498414?spm=a2c4e.11153940.0.0.51284e92NNKASg

https://yq.aliyun.com/articles/55676

